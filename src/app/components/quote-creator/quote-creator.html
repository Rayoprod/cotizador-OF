<div class="container my-4 my-md-5">
  <div class="card shadow-sm">
    <div class="card-header bg-light p-4">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-center">
        <div class="mb-3 mb-md-0">
          <img src="assets/logowym.png" alt="Logo" class="logo-image">
        </div>
        <div class="text-md-end">
          <h1 class="h2 mb-0">COTIZACIÓN1</h1>
          <span class="d-block text-muted">{{ numeroCotizacion }}</span>
        </div>
      </div>
    </div>
    <div class="card-body p-4">
      <div class="row mb-4">
        <div class="col-md-7 mb-3 mb-md-0">
          <label for="cliente" class="form-label">Cliente</label>
          <input type="text" id="cliente" class="form-control" [(ngModel)]="cliente" placeholder="Nombre del cliente">
        </div>
        <div class="col-md-5">
          <label for="fecha" class="form-label">Fecha</label>
          <input type="text" id="fecha" class="form-control" [(ngModel)]="fecha" placeholder="DD/MM/AAAA">
        </div>
      </div>

      <div class="row mb-4 p-3 bg-light border rounded">
        <div class="col-md-6 mb-2 mb-md-0">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" role="switch" id="incluirIgvCheck" [(ngModel)]="incluirIGV">
            <label class="form-check-label" for="incluirIgvCheck">Incluir IGV (18%)</label>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" role="switch" id="entregaObraCheck" [(ngModel)]="entregaEnObra">
            <label class="form-check-label" for="entregaObraCheck">Entrega en Obra</label>
          </div>
        </div>
      </div>

      <h3 class="mb-3 border-bottom pb-2">Detalle</h3>
      <div class="table-responsive">
        <table class="table align-middle">
          <thead class="table-light d-none d-md-table-header-group">
            <tr>
              <th scope="col" style="width: 5%;">#</th>
              <th scope="col">Descripción</th>
              <th scope="col" style="width: 10%;">Unidad</th>
              <th scope="col" class="text-end" style="width: 15%;">Cantidad</th>
              <th scope="col" class="text-end" style="width: 15%;">P. Unitario</th>
              <th scope="col" class="text-end" style="width: 15%;">Total</th>
              <th scope="col" style="width: 5%;"></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of items; let i = index" class="item-row">
              <th scope="row" class="item-number" data-label="#">{{ i + 1 }}</th>
              <td data-label="Descripción">
                <input
                  type="text"
                  class="form-control"
                  [(ngModel)]="item.descripcion"
                  [ngbTypeahead]="search"
                  (selectItem)="onSelectItem($event, item)"
                  placeholder="Escribe para buscar..."
                >
              </td>
              <td data-label="Unidad"><input type="text" class="form-control" [(ngModel)]="item.unidad" placeholder="Und."></td>
              <td data-label="Cantidad"><input type="number" class="form-control text-end" [(ngModel)]="item.cantidad" placeholder="Cantidad"></td>
              <td data-label="P. Unitario"><input type="number" class="form-control text-end" [(ngModel)]="item.precioUnitario" placeholder="0.00"></td>
              <td data-label="Total" class="text-end fw-bold">{{ ( (item.cantidad || 0) * (item.precioUnitario || 0)) | currency:'S/ ' }}</td>
              <td class="text-center">
                <button class="btn btn-outline-danger btn-sm" (click)="removeItem(item.id)">
                  &times;
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <button class="btn btn-outline-primary mt-3" (click)="addItem()">+ Añadir Item</button>

      <div class="row justify-content-end mt-4">
        <div class="col-md-5">
          <ul class="list-group">
            <ng-container *ngIf="incluirIGV">
              <li class="list-group-item d-flex justify-content-between align-items-center">
                Subtotal
                <span>{{ subtotal | currency:'S/ ' }}</span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                IGV (18%)
                <span>{{ igv | currency:'S/ ' }}</span>
              </li>
            </ng-container>
            <li class="list-group-item d-flex justify-content-between align-items-center fw-bold h5 text-primary">
              <span>{{ incluirIGV ? 'TOTAL' : 'TOTAL SIN IGV' }}</span>
              <span>{{ total | currency:'S/ ' }}</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="card-footer text-center p-3">
      <button class="btn btn-success btn-lg" (click)="generarPDF()">
        Generar PDF
      </button>
    </div>
  </div>
</div>
